## 1. Концепция (Vision)

Веб-платформа (аналог Giphy/Tenor), специализирующаяся на **коротких видео-мемах со звуком**. Основная ценность — упрощение создания мемов: пользователь может загрузить картинку/GIF и наложить на неё аудио прямо в браузере, либо заменить звук в существующем видео. Платформа включает социальные механики и глубокую интеграцию с мессенджерами (Telegram, Discord).

---

## 2. Роли Пользователей

1. **Гость (Unauthenticated):**
* Просмотр ленты (Trending).
* Поиск мемов.
* Шеринг (копирование ссылки).
* Не может лайкать, комментировать или загружать.


2. **Пользователь (User):**
* Загрузка и создание мемов (Meme Editor).
* Лайки (избранное).
* Комментарии.
* Управление своим профилем (аватар, био).
* Подписка на теги или других авторов (опционально для v2).


3. **Модератор/Админ:**
* Доступ к панели модерации (`/admin`).
* Просмотр очереди "Pending" (новые загрузки).
* Действия: Approve (публикация), Reject (отклонение с причиной), Ban User.



---

## 3. Функциональные Блоки (Features)

### 3.1. Авторизация и Профиль

* **Методы:** Email/Password (Magic Link или обычный), Google Auth, Telegram Auth (через виджет).
* **Профиль пользователя:**
* Обложка и Аватар.
* Сетка загруженных мемов (Grid Layout).
* Вкладка "Liked" (понравившиеся мемы).
* Статистика: суммарное количество просмотров профиля.



### 3.2. Meme Creator (Конструктор Мемов)

Это ключевая фича. Процесс загрузки состоит из этапов:

**Входные данные:**

1. **Visual Source:** Файл (JPG, PNG, GIF, WEBM, MP4).
2. **Audio Source:** Файл (MP3, WAV, M4A).

**Логика обработки (Backend FFmpeg):**

* **Image + Audio:** Создается видеопоток из статичной картинки длительностью, равной аудиодорожке.
* **GIF + Audio:** GIF зацикливается (loop) столько раз, сколько нужно, чтобы покрыть длину аудио.
* **Video + Audio:** Из видео удаляется оригинальный звук, накладывается новый. Видео обрезается или зацикливается (выбор пользователя: "Fit video to audio" или "Fit audio to video").

**Метаданные (обязательные поля):**

* **Title:** Название мема.
* **Description:** Описание (учитывается в поиске).
* **Subject/Character:** *Сущность* на меме. Это отдельная база данных (не просто теги).
* *Пример:* Райан Гослинг, Шрек, Папич, Counter-Strike 2.
* Пользователь начинает вводить, система предлагает из базы или создает нового.


* **Tags:** Хэштеги (например: #sad, #funny, #fail).

### 3.3. Лента и Просмотр (Viewer)

* **Masonry Grid:** "Кирпичная" раскладка (как Pinterest), чтобы видео разного соотношения сторон смотрелись органично.
* **Autoplay:** При наведении мыши (desktop) или при скролле (mobile) видео проигрывается без звука.
* **Meme Page:** Отдельная страница `/meme/{id}`.
* Плеер с контролами громкости.
* Кнопка "Download" (скачать MP4).
* Блок "Related Memes" (похожие по тегам или Subject).
* Секция комментариев.



### 3.4. Поиск (Search Engine)

* Поиск по трем направлениям:
1. Текст (название/описание).
2. Теги.
3. Subjects (Персонажи).


* Исправление опечаток (Fuzzy Search).

### 3.5. Модерация

* Все загруженные мемы получают статус `PENDING`.
* Они не видны в общей ленте и поиске, но доступны по прямой ссылке (для шеринга друзьям сразу).
* В общей ленте появляются только после статуса `APPROVED`.
* *Оптимизация:* Доверенные пользователи (whitelist) пропускают модерацию.

---

## 4. Интеграции (Bots)

### 4.1. Telegram Bot (@mymemebot)

* **Inline Mode (Главная фича):**
* Пользователь в любом чате пишет `@mymemebot <запрос>`.
* Появляется выпадающий список с превью (GIF/Video).
* При клике отправляется видео (как нативное MP4 Telegram video).


* **Bot PM:**
* Команда `/upload` — выдает ссылку на веб-форму загрузки.
* Команда `/random` — присылает случайный мем.



### 4.2. Discord Integration

* **Rich Embeds (Open Graph):**
* Самое важное: когда пользователь кидает ссылку `https://mymemes.com/meme/123` в Дискорд, она должна разворачиваться в плеер.
* Для этого используются мета-теги: `<meta property="og:video" content="..." />`.


* **Discord Bot:**
* Слэш-команда `/meme search <query>` — бот ищет и постит мем в канал.



---

## 5. Технические требования (Stack & Tools)

* **Frontend:** Next.js (App Router), React, TailwindCSS, Framer Motion (для анимаций).
* **UI Kit:** Shadcn/UI.
* **State Management:** React Query (TanStack Query) — для кэширования API запросов.
* **Backend:** Python (FastAPI).
* **Database:** PostgreSQL (Supabase).
* **File Storage:** S3 (Supabase Storage / MinIO).
* **Media Processing:** `ffmpeg-python`.
* **Search:** Meilisearch (интегрирован через sync-скрипт или webhook базы данных).

---

## 6. Структура Базы Данных (ERD Outline)

1. **Users:** `id`, `username`, `email`, `role`, `avatar_url`.
2. **Subjects:** `id`, `name` (unique), `category` (person, game, movie), `image_url`.
3. **Tags:** `id`, `name`.
4. **Memes:**
* `id`, `user_id`
* `media_url`, `thumbnail_url`
* `title`, `description`
* `status` (enum: pending, approved, rejected)
* `subject_id` (FK -> Subjects) - *один главный персонаж* (или Many-to-Many, если персонажей несколько).
* `search_vector` (TSVECTOR для базового поиска PG, если не используем Meili сразу).


5. **MemeTags:** Many-to-Many связь.
6. **Interactions:** `Likes`, `Comments`.